<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>HistStruct - Documentation for the ML4DQM/DC notebooks</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Documentation for the ML4DQM/DC notebooks</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">omsapi <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../omsapi/readme/">readme</a>
</li>
                                    
<li >
    <a href="../../omsapi/get_oms_data/">get_oms_data</a>
</li>
                                    
<li >
    <a href="../../omsapi/omsapi/">omsapi</a>
</li>
                                    
<li >
    <a href="../../omsapi/urls/">urls</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">omsinterface <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../omsinterface/readme/">readme</a>
</li>
                                    
<li >
    <a href="../../omsinterface/cert/">cert</a>
</li>
                                    
<li >
    <a href="../../omsinterface/connectiontools/">connectiontools</a>
</li>
                                    
<li >
    <a href="../../omsinterface/get_oms_data/">get_oms_data</a>
</li>
                                    
<li >
    <a href="../../omsinterface/omstools/">omstools</a>
</li>
                                    
<li >
    <a href="../../omsinterface/urls/">urls</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">src <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li class="active">
    <a href="./">HistStruct</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">classifiers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../classifiers/AutoEncoder/">AutoEncoder</a>
</li>
            
<li >
    <a href="../classifiers/HistogramClassifier/">HistogramClassifier</a>
</li>
            
<li >
    <a href="../classifiers/MaxPullClassifier/">MaxPullClassifier</a>
</li>
            
<li >
    <a href="../classifiers/NMFClassifier/">NMFClassifier</a>
</li>
            
<li >
    <a href="../classifiers/TemplateBasedClassifier/">TemplateBasedClassifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">cloudfitters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../cloudfitters/CloudFitter/">CloudFitter</a>
</li>
            
<li >
    <a href="../cloudfitters/ExponentialFitter/">ExponentialFitter</a>
</li>
            
<li >
    <a href="../cloudfitters/GaussianKdeFitter/">GaussianKdeFitter</a>
</li>
            
<li >
    <a href="../cloudfitters/LogNormalFitter/">LogNormalFitter</a>
</li>
            
<li >
    <a href="../cloudfitters/SeminormalFitter/">SeminormalFitter</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">utils <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../utils/autoencoder_utils/">autoencoder_utils</a>
</li>
                                    
<li >
    <a href="../../utils/clustering_utils/">clustering_utils</a>
</li>
                                    
<li >
    <a href="../../utils/csv_utils/">csv_utils</a>
</li>
                                    
<li >
    <a href="../../utils/dataframe_utils/">dataframe_utils</a>
</li>
                                    
<li >
    <a href="../../utils/generate_data_2d_utils/">generate_data_2d_utils</a>
</li>
                                    
<li >
    <a href="../../utils/generate_data_utils/">generate_data_utils</a>
</li>
                                    
<li >
    <a href="../../utils/hist_utils/">hist_utils</a>
</li>
                                    
<li >
    <a href="../../utils/json_utils/">json_utils</a>
</li>
                                    
<li >
    <a href="../../utils/plot_utils/">plot_utils</a>
</li>
                                    
<li >
    <a href="../../utils/refruns_utils/">refruns_utils</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../omsinterface/urls/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../classifiers/AutoEncoder/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#histstruct">HistStruct</a></li>
            <li><a href="#histstructobject">HistStruct(object)</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="histstruct">HistStruct</h1>
<h2 id="histstructobject">HistStruct(object)</h2>
<pre><code class="text">main data structure used within this framework  
a HistStruct object basically consists of a mutually consistent collection of numpy arrays,  
where each numpy array corresponds to one histogram type, with dimensions (number of histograms, number of bins).  
the HistStruct has functions to easily perform the following common tasks (among others):  
- select a subset of runs and/or lumisections (e.g. using a json file formatted selector),  
- prepare the data for machine learning training  
- evaluate classifiers (machine learning types or other)  
</code></pre>

<h3 id="init-self"><strong>init</strong>( self )</h3>
<pre><code class="text">empty initializer, setting all containers to empty defaults  
a HistStruct object has the following properties:  
histnames: list of histogram names  
histograms: dict mapping histogram name to 2D numpy array of histograms (shape (nhists,nbins))  
nentries: dict mapping histogram name to 1D numpy array of number of entries per histogram (same length as histograms)  
runnbs: 1D numpy array of run numbers (same length as histograms)  
lsnbs: 1D numpy array of lumisection numbers (same length as histograms)  
classifiers: dict mapping histogram name to object of type HistogramClassifier  
scores: dict mapping histogram name to 1D numpy array of values associated to the histograms (same length as histograms)  
masks: dict mapping name to 1D numpy array of booleans (same length as histograms) that can be used for masking  
exthistograms: dict similar to histograms for additional (e.g. artificially generated) histograms  
</code></pre>

<h3 id="save-self-path">save( self, path )</h3>
<pre><code class="text">save a HistStruct object to a pkl file  
input arguments:  
- path where to store the file (appendix .pkl is automatically appended)  
</code></pre>

<h3 id="load-self-path">load( self, path )</h3>
<pre><code class="text">load a HistStruct object from a pkl file  
input arguments:  
- path to a pkl file containing a HistStruct object  
</code></pre>

<h3 id="add_dataframe-self-df-cropslicesnone-donormalizetrue-rebinningfactornone">add_dataframe( self, df, cropslices=None, donormalize=True, rebinningfactor=None )</h3>
<pre><code class="text">add a dataframe to a HistStruct  
input arguments:  
- df: a pandas dataframe as read from the input csv files  
- cropslices: list of slices (one per dimension) by which to crop the histograms  
- donormalize: boolean whether to normalize the histograms  
- rebinningfactor: factor by which to group bins together  
for more details on cropslices, donormalize and rebinningfactor, see hist_utils.py / preparedatafromdf!  
notes:  
- the new dataframe can contain one or multiple histogram types  
- the new dataframe must contain the same run and lumisection numbers (for each histogram type in it)  
  as already present in the HistStruct, except if it is the first one to be added  
- alternative to adding the dataframe with the options cropslices, donormalize and rebinningfactor  
  (that will be passed down to preparedatafromdf), one can also call preparedatafromdf manually and add it  
  with add_histograms, allowing for more control over complicated preprocessing.  
</code></pre>

<h3 id="add_histograms-self-histname-histograms-runnbs-lsnbs-nentriesnone">add_histograms( self, histname, histograms, runnbs, lsnbs, nentries=None )</h3>
<pre><code class="text">add a set of histograms to a HistStruct  
input arguments:  
- histname: name of the histogram type to be added  
- histograms: a numpy array of shape (nhistograms,nbins), assumed to be of a single type  
- runnbs: a 1D list or array of length nhistograms containing the run number per histogram  
- lsnbs: a 1D list or array of length nhistograms containing the lumisection number per histogram  
- nentries: a 1D list or array of length nhistograms containing the number of entries per histogram  
  notes:  
  - must be provided explicitly since histograms might be normalized,   
    in which case the number of entries cannot be determined from the sum of bin contents.  
  - used for (de-)selecting histograms with sufficient statistics;   
    if you don't need that type of selection, nentries can be left at default.  
  - default is None, meaning all entries will be set to zero.  
notes:  
- no preprocessing is performed, this is assumed to have been done manually (if needed) before adding the histograms  
- runnbs and lsnbs must correspond to what is already in the current HistStruct, except if this is the first set of histogram to be added  
- see also add_dataframe for an alternative way of adding histograms  
</code></pre>

<h3 id="add_mask-self-name-mask">add_mask( self, name, mask )</h3>
<pre><code class="text">add a mask to a HistStruct  
input arguments:  
- name: a name for the mask  
- mask: a 1D np array of booleans  with same length as number of lumisections in HistStruct  
</code></pre>

<h3 id="remove_mask-self-name">remove_mask( self, name )</h3>
<pre><code class="text">inverse operation of add_mask  
</code></pre>

<h3 id="add_json_mask-self-name-jsondict">add_json_mask( self, name, jsondict )</h3>
<pre><code class="text">add a mask corresponding to a json dict  
input arguments:  
- name: a name for the mask  
- jsondict: a dictionary in typical json format (see the golden json file for inspiration)  
all lumisections present in the jsondict will be masked True, the others False.  
</code></pre>

<h3 id="add_goldenjson_mask-self-name">add_goldenjson_mask( self, name )</h3>
<pre><code class="text">add a mask corresponding to the golden json file  
input arguments:  
- name: a name for the mask  
</code></pre>

<h3 id="add_dcsonjson_mask-self-name">add_dcsonjson_mask( self, name )</h3>
<pre><code class="text">add a mask corresponding to the DCS-bit on json file  
input arguments:  
- name: a name for the mask  
</code></pre>

<h3 id="add_hightstat_mask-self-name-histnamesnone-entries_to_bins_ratio100">add_hightstat_mask( self, name, histnames=None, entries_to_bins_ratio=100 )</h3>
<pre><code class="text">add a mask corresponding to lumisections where all histograms have sufficient statistics  
input arguments:  
- histnames: list of histogram names to take into account for making the mask (default: all in the HistStruct)  
- entries_to_bins_ratio: criterion to determine if a histogram has sufficient statistics, number of entries divided by number of bins  
</code></pre>

<h3 id="get_combined_mask-self-names">get_combined_mask( self, names )</h3>
<pre><code class="text">get a combined mask given multiple mask names  
mostly for internal use; externally you can use get_histograms( histname, &lt;list of mask names&gt;) directly  
</code></pre>

<h3 id="get_runnbs-self-masknamesnone">get_runnbs( self, masknames=None )</h3>
<pre><code class="text">get the array of run numbers, optionally after masking  
input arguments:  
- masknames: list of names of masks (default: no masking, return full array)  
</code></pre>

<h3 id="get_lsnbs-self-masknamesnone">get_lsnbs( self, masknames=None )</h3>
<pre><code class="text">get the array of lumisection numbers, optionally after masking  
input arguments:  
- masknames: list of names of masks (default: no masking, return full array)  
</code></pre>

<h3 id="get_index-self-runnb-lsnb">get_index( self, runnb, lsnb )</h3>
<pre><code class="text">get the index in the current HistStruct of a given run and lumisection number  
input arguments:  
- runnb and lsnb: run and lumisection number respectively  
</code></pre>

<h3 id="get_scores-self-histnamenone-masknamesnone">get_scores( self, histname=None, masknames=None )</h3>
<pre><code class="text">get the array of scores for a given histogram type, optionally after masking  
input arguments:  
- histname: name of the histogram type for which to retrieve the score.   
  if None, return a dict matching histnames to arrays of scores  
- masknames: list of names of masks (default: no masking, return full array)  
notes:  
- this method takes the scores from the HistStruct.scores attribute;  
  make sure to have evaluated the classifiers before calling this method,  
  else an exception will be thrown.  
</code></pre>

<h3 id="get_scores_ls-self-runnb-lsnb-histnamesnone-suppresswarningsfalse">get_scores_ls( self, runnb, lsnb, histnames=None, suppresswarnings=False )</h3>
<pre><code class="text">get the scores for a given run/lumisection number and for given histogram names  
input arguments:  
- runnb: run number  
- lsnb: lumisection number  
- histnames: names of the histogram types for which to retrieve the score.   
returns:  
- a dict matching each name in histnames to a score (or None if no valid score)  
notes:  
- this method takes the scores from the HistStruct.scores attribute;  
  make sure to have evaluated the classifiers before calling this method,  
  else the returned scores will be None.  
</code></pre>

<h3 id="get_histograms-self-histnamenone-masknamesnone">get_histograms( self, histname=None, masknames=None )</h3>
<pre><code class="text">get the array of histograms for a given type, optionally after masking  
input arguments:  
- histname: name of the histogram type to retrieve   
  if None, return a dict matching histnames to arrays of histograms  
- masknames: list of names of masks (default: no masking, return full array)  
</code></pre>

<h3 id="add_classifier-self-histname-classifier-evaluatefalse">add_classifier( self, histname, classifier, evaluate=False )</h3>
<pre><code class="text">add a histogram classifier for a given histogram name to the HistStruct  
input arguments:  
- histname: a valid histogram name present in the HistStruct to which this classifier applies  
- classifier: an object of type HistogramClassifier (i.e. of any class that derives from it)  
- evaluate: a bool whether to evaluate the classifier (and store the result in the 'scores' attribute)  
  if set to True, the result is both returned and stored in the 'scores' attribute.  
</code></pre>

<h3 id="evaluate_classifier-self-histname">evaluate_classifier( self, histname )</h3>
<pre><code class="text">evaluate a histogram classifier for a given histogram name in the HistStruct  
input arguments:  
- histname: a valid histogram name present in the HistStruct for which to evaluate the classifier  
notes:  
- the result is both returned and stored in the 'scores' attribute  
</code></pre>

<h3 id="plot_ls-self-runnb-lsnb-histnamesnone-recohistnone-recohistlabelreco-refhistsnone-refhistslabelreference">plot_ls( self, runnb, lsnb, histnames=None, recohist=None, recohistlabel='reco', refhists=None, refhistslabel='reference')</h3>
<pre><code class="text">plot the histograms in a HistStruct for a given run/ls number versus their references and/or their reconstruction  
note: so far only for 1D histograms.  
      case of 2D histograms requires different plotting method since they cannot be clearly overlaid.  
      if a HistStruct contains both 1D and 2D histograms, the 1D histograms must be selected with the histnames argument.  
input arguments:  
- runnb: run number  
- lsnb: lumisection number  
- histnames: names of histogram types to plot (default: all)  
- recohist: dict matching histogram names to reconstructed histograms  
  notes: - 'reconstructed histograms' refers to e.g. autoencoder or NMF reconstructions;  
           some models (e.g. simply looking at histogram moments) might not have this kind of reconstruction  
         - in principle one histogram per key is expected, but still the the shape must be 2D (i.e. (1,nbins))  
         - in case recohist is set to 'auto', the reconstruction is calculated on the fly for the input histograms  
- recohistlabel: legend entry for the reco histograms  
- refhists: dict matching histogram names to reference histograms  
  notes: - multiple histograms (i.e. a 2D array) per key are expected;  
           in case there is only one reference histogram, it must be reshaped into (1,nbins)  
- refhistslabel: legend entry for the reference histograms  
</code></pre>

<h3 id="plot_run-self-runnb-recohistnone-recohistlabelreco-refhistsnone-refhistslabelreference-doprintfalse">plot_run( self, runnb, recohist=None, recohistlabel='reco', refhists=None, refhistslabel='reference', doprint=False)</h3>
<pre><code class="text">call plot_ls for all lumisections in a given run  
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
