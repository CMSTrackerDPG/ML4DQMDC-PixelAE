<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>autoencoder_utils - Documentation for the ML4DQM/DC notebooks</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Documentation for the ML4DQM/DC notebooks</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">omsapi <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../omsapi/readme/">readme</a>
</li>
                                    
<li >
    <a href="../../omsapi/get_oms_data/">get_oms_data</a>
</li>
                                    
<li >
    <a href="../../omsapi/omsapi/">omsapi</a>
</li>
                                    
<li >
    <a href="../../omsapi/urls/">urls</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">omsinterface <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../omsinterface/readme/">readme</a>
</li>
                                    
<li >
    <a href="../../omsinterface/cert/">cert</a>
</li>
                                    
<li >
    <a href="../../omsinterface/connectiontools/">connectiontools</a>
</li>
                                    
<li >
    <a href="../../omsinterface/get_oms_data/">get_oms_data</a>
</li>
                                    
<li >
    <a href="../../omsinterface/omstools/">omstools</a>
</li>
                                    
<li >
    <a href="../../omsinterface/urls/">urls</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">src <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../src/HistStruct/">HistStruct</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">classifiers</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../src/classifiers/AutoEncoder/">AutoEncoder</a>
</li>
            
<li >
    <a href="../../src/classifiers/HistogramClassifier/">HistogramClassifier</a>
</li>
            
<li >
    <a href="../../src/classifiers/MaxPullClassifier/">MaxPullClassifier</a>
</li>
            
<li >
    <a href="../../src/classifiers/NMFClassifier/">NMFClassifier</a>
</li>
            
<li >
    <a href="../../src/classifiers/TemplateBasedClassifier/">TemplateBasedClassifier</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">cloudfitters</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../src/cloudfitters/CloudFitter/">CloudFitter</a>
</li>
            
<li >
    <a href="../../src/cloudfitters/ExponentialFitter/">ExponentialFitter</a>
</li>
            
<li >
    <a href="../../src/cloudfitters/GaussianKdeFitter/">GaussianKdeFitter</a>
</li>
            
<li >
    <a href="../../src/cloudfitters/LogNormalFitter/">LogNormalFitter</a>
</li>
            
<li >
    <a href="../../src/cloudfitters/SeminormalFitter/">SeminormalFitter</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">utils <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li class="active">
    <a href="./">autoencoder_utils</a>
</li>
                                    
<li >
    <a href="../clustering_utils/">clustering_utils</a>
</li>
                                    
<li >
    <a href="../csv_utils/">csv_utils</a>
</li>
                                    
<li >
    <a href="../dataframe_utils/">dataframe_utils</a>
</li>
                                    
<li >
    <a href="../generate_data_2d_utils/">generate_data_2d_utils</a>
</li>
                                    
<li >
    <a href="../generate_data_utils/">generate_data_utils</a>
</li>
                                    
<li >
    <a href="../hist_utils/">hist_utils</a>
</li>
                                    
<li >
    <a href="../json_utils/">json_utils</a>
</li>
                                    
<li >
    <a href="../plot_utils/">plot_utils</a>
</li>
                                    
<li >
    <a href="../refruns_utils/">refruns_utils</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../src/cloudfitters/SeminormalFitter/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../clustering_utils/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#autoencoder-utils">autoencoder utils</a></li>
            <li><a href="#msetop10y_true-y_pred">mseTop10(y_true, y_pred)</a></li>
            <li><a href="#msetop10rawy_true-y_pred">mseTop10Raw(y_true, y_pred)</a></li>
            <li><a href="#msetopnrawy_true-y_pred-n10">mseTopNRaw(y_true, y_pred, n=10)</a></li>
            <li><a href="#chisquaredy_true-y_pred">chiSquared(y_true, y_pred)</a></li>
            <li><a href="#chisquaredtop10y_true-y_pred">chiSquaredTop10(y_true, y_pred)</a></li>
            <li><a href="#calculate_rocscores-labels-scoreax">calculate_roc(scores, labels, scoreax)</a></li>
            <li><a href="#get_rocscores-labels-modelin-npoints100-doprintfalse-doplottrue-plotmodeclassic">get_roc(scores, labels, mode='lin', npoints=100, doprint=False, doplot=True, plotmode='classic')</a></li>
            <li><a href="#get_roc_from_histshists-labels-predicted_hists-modelin-npoints100-doprintfalse-doplottrue-plotmodeclassic">get_roc_from_hists(hists, labels, predicted_hists, mode='lin', npoints=100, doprint=False, doplot=True, plotmode='classic')</a></li>
            <li><a href="#get_confusion_matrixscores-labels-wp">get_confusion_matrix(scores, labels, wp)</a></li>
            <li><a href="#get_confusion_matrix_from_histshists-labels-predicted_hists-msewp">get_confusion_matrix_from_hists(hists, labels, predicted_hists, msewp)</a></li>
            <li><a href="#getautoencoderinput_sizearchactoptadamlossmsetop10">getautoencoder(input_size,arch,act=[],opt='adam',loss=mseTop10)</a></li>
            <li><a href="#train_simple_autoencoderhistsnepochs-1modelname">train_simple_autoencoder(hists,nepochs=-1,modelname='')</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="autoencoder-utils">autoencoder utils</h1>
<h2 id="msetop10y_true-y_pred">mseTop10(y_true, y_pred)</h2>
<pre><code class="text">MSE top 10 loss function for autoencoder training  
input arguments:  
- y_true and y_pred: two numpy arrays of equal shape,  
  typically a histogram and its autoencoder reconstruction.  
  if two-dimensional, the arrays are assumed to have shape (nhists,nbins)!  
output:  
- mean squared error between y_true and y_pred,  
  where only the 10 bins with largest squared error are taken into account.  
  if y_true and y_pred are 2D arrays, this function returns 1D array (mseTop10 for each histogram)  
</code></pre>

<h2 id="msetop10rawy_true-y_pred">mseTop10Raw(y_true, y_pred)</h2>
<pre><code class="text">same as mseTop10 but without using tf or K  
the version including tf or K seemed to cause randomly dying kernels, no clear reason could be found,  
but it was solved using this loss function instead.  
verified that it gives exactly the same output as the function above on some random arrays.  
contrary to mseTop10, this function only works for arrays with 2D shapes (so shape (nhists,nbins)), not for (nbins,).  
</code></pre>

<h2 id="msetopnrawy_true-y_pred-n10">mseTopNRaw(y_true, y_pred, n=10)</h2>
<pre><code class="text">generalization of mseTop10Raw to any number of bins to take into account  
note: now generalized to also work for 2D histograms, i.e. arrays of shape (nhists,nybins,nxbins)!  
      hence this is the most general method and preferred above mseTop10 and mseTop10Raw, which are only kept for reference  
input arguments:  
- y_true, y_pred: numpy arrays between which to calculate the mean square difference, of shape (nhists,nbins) or (nhists,nybins,nxbins)  
- n: number of largest elements to keep for averaging  
output:  
numpy array of shape (nhists)  
</code></pre>

<h2 id="chisquaredy_true-y_pred">chiSquared(y_true, y_pred)</h2>
<pre><code class="text">chi2 loss functionfor autoencoder training  
input arguments:  
- y_true and y_pred: two numpy arrays of equal shape,  
  typically a histogram and its autoencoder reconstruction.  
  if two-dimensional, the arrays are assumed to have shape (nhists,nbins)!  
output:  
- relative mean squared error between y_true and y_pred,  
  if y_true and y_pred are 2D arrays, this function returns 1D array (chiSquared for each histogram)  
</code></pre>

<h2 id="chisquaredtop10y_true-y_pred">chiSquaredTop10(y_true, y_pred)</h2>
<pre><code class="text">same as chiSquared but take into account only 10 largest values in averaging.  
</code></pre>

<h2 id="calculate_rocscores-labels-scoreax">calculate_roc(scores, labels, scoreax)</h2>
<pre><code class="text">calculate a roc curve  
input arguments:  
- scores is a 1D numpy array containing output scores of any algorithm  
- labels is a 1D numpy array (equally long as scores) containing labels  
  note that 1 for signal and 0 for background is assumed!  
  this convention is only used to define what scores belong to signal or background;  
  the scores itself can be anything (not limited to (0,1)),   
  as long as the target for signal is higher than the target for background  
- scoreax is an array of score thresholds for which to compute the signal and background efficiency,  
  assumed to be sorted in increasing order (i.e. from loose to tight)  
output:  
tuple of two np arrays (signal efficiency and background efficiency)  
</code></pre>

<h2 id="get_rocscores-labels-modelin-npoints100-doprintfalse-doplottrue-plotmodeclassic">get_roc(scores, labels, mode='lin', npoints=100, doprint=False, doplot=True, plotmode='classic')</h2>
<pre><code class="text">make a ROC curve  
input arguments:  
- scores is a 1D numpy array containing output scores of any algorithm  
- labels is a 1D numpy array (equally long as scores) containing labels  
  note that 1 for signal and 0 for background is assumed!  
  this convention is only used to define what scores belong to signal or background;  
  the scores itself can be anything (not limited to (0,1)),   
  as long as the target for signal is higher than the target for background  
- mode: how to determine the points where to calculate signal and background efficiencies; options are:  
        - 'lin': np.linspace between min and max score  
        - 'geom': np. geomspace between min and max score  
        - 'full': one point per score instance  
- npoints: number of points where to calculate the signal and background efficiencies  
  (ignored if mode is 'full')  
- doprint: boolean whether to print score thresholds and corresponding signal and background efficiencies  
- doplot: boolean whether to make a plot or simply return the auc.  
- plotmode: how to plot the roc curve; options are:  
        - 'classic' = signal efficiency afo background efficiency  
</code></pre>

<h2 id="get_roc_from_histshists-labels-predicted_hists-modelin-npoints100-doprintfalse-doplottrue-plotmodeclassic">get_roc_from_hists(hists, labels, predicted_hists, mode='lin', npoints=100, doprint=False, doplot=True, plotmode='classic')</h2>
<pre><code class="text">make a ROC curve without manually calculating the scores  
the output score is the mseTop10Raw between the histograms and their reconstruction  
- input arguments:  
- hists and predicted_hists are 2D numpy arrays of shape (nhistograms,nbins)  
- other arguments: see get_roc  
</code></pre>

<h2 id="get_confusion_matrixscores-labels-wp">get_confusion_matrix(scores, labels, wp)</h2>
<pre><code class="text">plot a confusion matrix  
scores and labels are defined in the same way as for get_roc  
wp is the chosen working point   
(i.e. any score above wp is flagged as signal, any below is flagged as background)  
</code></pre>

<h2 id="get_confusion_matrix_from_histshists-labels-predicted_hists-msewp">get_confusion_matrix_from_hists(hists, labels, predicted_hists, msewp)</h2>
<pre><code class="text">plot a confusion matrix without manually calculating the scores  
the output score is the mse between the histograms and their reconstruction  
</code></pre>

<h2 id="getautoencoderinput_sizearchactoptadamlossmsetop10">getautoencoder(input_size,arch,act=[],opt='adam',loss=mseTop10)</h2>
<pre><code class="text">get a trainable autoencoder model  
input args:  
- input_size: size of vector that autoencoder will operate on  
- arch: list of number of nodes per hidden layer (excluding input and output layer)  
- act: list of activations per layer (default: tanh)  
- opt: optimizer to use (default: adam)  
- loss: loss function to use (defualt: mseTop10)  
</code></pre>

<h2 id="train_simple_autoencoderhistsnepochs-1modelname">train_simple_autoencoder(hists,nepochs=-1,modelname='')</h2>
<pre><code class="text">create and train a very simple keras model  
the model consists of one hidden layer (with half as many units as there are input bins), tanh activation, adam optimizer and mseTop10 loss.  
input args:   
- hists is a 2D numpy array of shape (nhistograms, nbins)  
- nepochs is the number of epochs to use (has a default value if left unspecified)  
- modelname is a file name to save the model in (default: model is not saved to a file)  
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
